<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.pgy.mapper.OrderMapper">
	
	
	<!-- 分页sql基本代码 -->
	<sql id="pageSql">
		from p_order 
		<where>
		   <if test="orderId !=null &amp;&amp; orderId !=''">
		    orderId like concat('%',#{orderId},'%')
		   </if>
		   <if test="goodsId !=null &amp;&amp; goodsId !=''">
		    and goodsId = #{goodsId}
		   </if>
		   <if test="status !=null &amp;&amp; status !=''">
		    and status = #{status}
		   </if>
	  </where>
		order by orderTime desc
		
	</sql>
	<!-- 具体的分页语句 -->				   
	<select id="findByPage" resultMap="orderBaseResultMap">
		<trim prefix="select * " suffix="limit">
			<include refid="pageSql"/>
		</trim>
		#{pageModel.startRow},#{pageModel.pageSize}
	</select>
	
	
	
	<!-- 统计需要分页的行数 -->
	<select id="count" resultType="int">
		select count(*) <include refid="pageSql"/>
	</select>
	
	
	
	
	
	<insert id="addOrder">
		insert into p_order values
		(#{orderId},#{openId},#{goodsId},#{typeId},#{photoNum},#{money},#{siteId},#{status},#{orderTime},#{wxOrderId},#{goodsNum},#{payMoney},#{payTime})  
    	
	</insert>
	
	<delete id="delOrderByOrderId">
		delete from p_order where orderId = #{orderId}
	</delete>
	
	<update id="updateOrderSiteId">
		
		update p_order set siteId = #{siteId} where orderId = #{orderId}
		
	</update>
	
	<update id="updateOrderStatusByOrderId">
		
		update p_order set status = #{status} where orderId = #{orderId}
		
	</update>
	
	<update id="updateOrderStatus">
		
		update p_order set wxOrderId = #{wxOrderId},goodsNum = #{goodsNum},payMoney = #{payMoney},payTime = #{payTime},status = #{status} where orderId = #{orderId}
		
	</update>
	
	<select id="getOrderByOpenId" resultMap="orderBaseResultMap">
		
		select * from p_order where openId = #{openId} order by orderTime desc;
		
	</select>
	
	<select id="getOrderByOrderId" resultMap="orderBaseResultMap">
		
		select * from p_order where orderId = #{orderId}
		
	</select>
	
	
	<!-- 定义ResultMap -->
	<resultMap id="orderBaseResultMap" type="order" autoMapping="true"></resultMap>
	
</mapper>